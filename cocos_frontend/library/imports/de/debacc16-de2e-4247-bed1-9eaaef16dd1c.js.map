{"version":3,"sources":["assets/Script/ui/GamePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIPanel from \"./UIPanel\"\nimport UIManager from \"../UIManager\";\nimport { EUIPanelType, ECMDID } from \"../CommonEnum\";\nimport BWUnitManager from \"../BWUnitManager\";\nimport BWUnit from \"./BWUnit\";\nimport BWPlayerUnit from \"./BWPlayerUnit\";\nimport EventManager from \"../EventManager\";\n\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GamePanel extends UIPanel {\n\n    battleNode: cc.Node;\n    playerMe: BWUnit;\n    battleCamera: cc.Camera;\n    labelScore: cc.Label;\n\n    labelPlayerHp: cc.Label;\n\n    //onload->start->onopen\n    nCreateEnemyCd: number = 0.4;\n    nCreateEnemyCdDt: number = 0;\n\n    onLoad(){\n        \n        let btnBeginNode = this.node.getChildByName('btnbegin');\n        btnBeginNode.on(cc.Node.EventType.TOUCH_END, this.clickBegin.bind(this,109825),this);\n\n        this.battleNode = this.node.getChildByName('battlenode');\n        this.battleCamera = this.battleNode.getChildByName(\"battlecamera\").getComponent(cc.Camera);\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove.bind(this),this);\n\n        this.labelScore = this.node.getChildByName(\"playerhp\").getComponent(cc.Label);\n        this.labelPlayerHp = this.node.getChildByName(\"score\").getComponent(cc.Label);\n\n\n\n\n    }\n    start () {}\n    update(dt)\n    {\n        //cc.log(\"GamePanel\"+dt);\n        this.nCreateEnemyCdDt += dt;\n        if(this.nCreateEnemyCdDt > this.nCreateEnemyCd)\n        {\n            this.CreateEnemyUnit();\n            this.nCreateEnemyCdDt = 0;\n        }\n\n        let nScore = BWUnitManager.Instance.nScore;\n\n        let fPercent = nScore/200;\n        if(fPercent>1)\n        {\n            fPercent = 1;\n        }\n        \n        this.nCreateEnemyCd = 0.4- (fPercent) * 0.3;\n\n    }\n    lateUpdate()\n    {\n        this.battleCamera.node.y +=  this.playerMe.nSpeedY;\n    }\n    \n    RefreshPlayerHp()\n    {\n        let nPlayerHp = BWUnitManager.Instance.playerMe.nHp;\n        this.labelPlayerHp.string = nPlayerHp.toString();\n\n    }\n    RefreshScore()\n    {\n        let nScore = BWUnitManager.Instance.nScore;\n        this.labelScore.string = nScore.toString();\n    }\n\n    EventOpt(bAdd: boolean)\n    {\n        let optFun = null\n        if(bAdd)\n        {\n            EventManager.Instance.AddEvent(ECMDID.CREATEBULLET, this, this.CreateButtle);\n            EventManager.Instance.AddEvent(ECMDID.REFRESHPLAYERHP, this, this.RefreshPlayerHp); \n            EventManager.Instance.AddEvent(ECMDID.REFRESHSCORE, this, this.RefreshScore); \n\n                       \n        }\n        else\n        {\n            EventManager.Instance.RemoveEvent(ECMDID.CREATEBULLET, this, this.CreateButtle);\n            EventManager.Instance.RemoveEvent(ECMDID.REFRESHPLAYERHP, this, this.RefreshPlayerHp);\n            EventManager.Instance.RemoveEvent(ECMDID.REFRESHSCORE, this, this.RefreshScore); \n\n        }\n    }\n\n    OnOpen( strParam: string )\n    {\n        this.EventOpt(true);\n        this.InitPlayer();\n        this.labelPlayerHp.string = \"3\";\n        this.labelScore.string = \"0\";\n        BWUnitManager.Instance.SetGameBegin(true);\n\n    }\n\n    onClose(){\n        this.EventOpt(false);\n\n    }  \n    //--------\n\n    InitPlayer()\n    {\n        this.playerMe  = BWUnitManager.Instance.CreatePlayer();\n        this.playerMe.rootNode.position = new cc.Vec3(100,100, 0);\n        this.AddUnitToNode(this.playerMe);\n\n        this.CreateEnemyUnit();\n        //let bBox = this.playerMe.rootNode.getBoundingBox(); //Rect\n\n    }\n    CreateButtle()\n    {\n        let unit  = BWUnitManager.Instance.CreateBullet()\n        let nPosX = this.playerMe.rootNode.x;\n        let nPosY = this.playerMe.rootNode.y + 50;\n        unit.rootNode.position = new cc.Vec3(nPosX,nPosY, 0);\n        this.AddUnitToNode(unit);\n    }\n    CreateEnemyUnit()\n    {\n        let nR = Math.random();\n        //cc.log(\"nrrrr=\"+nR);\n        let enemy  = BWUnitManager.Instance.CreateEnemy()\n        let nPosX = Math.random()*640;\n        let nPosY = Math.random()*960 + this.battleCamera.node.y + this.battleNode.height;\n        enemy.rootNode.position = new cc.Vec3(nPosX,nPosY, 0);\n        this.AddUnitToNode(enemy);\n    }\n\n    touchMove(e)\n    {\n        cc.log( \"cc.Node.EventType.TOUCH_MOVE\" );\n        let move_x = e.touch._point.x - e.touch._prevPoint.x;\n        let move_y = e.touch._point.y - e.touch._prevPoint.y;\n        this.playerMe.rootNode.x = this.playerMe.rootNode.x + move_x;\n        this.playerMe.rootNode.y = this.playerMe.rootNode.y + move_y;\n        if(this.playerMe.rootNode.x < 0)\n        {\n            this.playerMe.rootNode.x = 0;\n        }\n        if(this.playerMe.rootNode.x > this.battleNode.width)\n        {\n            this.playerMe.rootNode.x = this.battleNode.width\n        }\n        if(this.playerMe.rootNode.y < this.battleCamera.node.y -  this.battleNode.height*0.5)\n        {\n            this.playerMe.rootNode.y = this.battleCamera.node.y -  this.battleNode.height*0.5;\n        }\n        if(this.playerMe.rootNode.y > this.battleCamera.node.y +  this.battleNode.height*0.5)\n        {\n             this.playerMe.rootNode.y = this.battleCamera.node.y +  this.battleNode.height*0.5\n        }\n    }\n\n    InOutCameraBottom( unit: BWUnit)\n    {\n        if(unit.rootNode.y < this.battleCamera.node.y -  this.battleNode.height*0.5)\n        {\n            return true;\n        }\n        return false;\n    }\n\n    InOutCameraTop( unit: BWUnit)\n    {\n        if(unit.rootNode.y > this.battleCamera.node.y +  this.battleNode.height*0.5)\n        {\n            return true;\n        }\n        return false\n    }\n\n    AddUnitToNode(unitNode: BWUnit)\n    {\n        this.battleNode.addChild(unitNode.rootNode);\n\n    }\n    \n    clickBegin(nTag){\n        cc.log('clickbegin'+nTag);\n        BWUnitManager.Instance.DeleteAllUnit();\n        BWUnitManager.Instance.SetGameBegin(false);\n        UIManager.Instance.closePanel(EUIPanelType.GAME);\n    }\n\n    \n}\n"]}