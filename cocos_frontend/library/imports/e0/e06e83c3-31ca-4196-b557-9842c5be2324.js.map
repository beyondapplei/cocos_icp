{"version":3,"sources":["assets/Script/BWUnitManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\n\nimport BWUnit from \"./ui/BWUnit\";\nimport BWPlayerUnit from \"./ui/BWPlayerUnit\";\nimport BWEnemyUnit from \"./ui/BWEnemyUnit\";\nimport BWBulletUnit from \"./ui/BWBulletUnit\";\nimport UIManager from \"./UIManager\";\nimport EventManager from \"./EventManager\";\n\nimport {ECMDID, ESceneType, EUIPanelType, EUnitType} from \"./CommonEnum\";\n\n\n\n\nexport default  class BWUnitManager {\n    public static readonly Instance: BWUnitManager = new BWUnitManager();\n    private constructor(){\n    }\n\n    mapEnemyUnit: {[key: number]: BWUnit} = [];\n    mapBulletUnit: {[key: number]: BWUnit} = {};\n    nScore: number = 0;\n\n    //vToDeleteUnit: BWUnit[] = [];\n    vToDeleteUnit: Array<BWUnit> = new Array<BWUnit>();\n\n    bBegin: boolean = false;\n    nCreateId: number = 0;\n\n    playerMe: BWPlayerUnit = null\n\n    Init(){\n    }\n\n    SetGameBegin(bBeginGame:boolean)\n    {\n        this.bBegin = bBeginGame;\n        this.nScore = 0;\n    }\n \n    GameOver()\n    {\n        this.bBegin = false;\n        UIManager.Instance.OpenPanel(EUIPanelType.GAMEEND);\n    }\n    DeleteAllUnit()\n    {\n        this.playerMe.OnDead();\n\n        for(let nIndex=0; nIndex < this.vToDeleteUnit.length; ++nIndex)\n        {\n            this.DeleteUnit(this.vToDeleteUnit[nIndex]);\n        }\n        this.vToDeleteUnit = [];\n\n        for(let key in this.mapEnemyUnit)\n        {\n            this.DeleteUnit(this.mapEnemyUnit[key]);\n        }\n        this.mapEnemyUnit = [];\n        for(let key in this.mapBulletUnit)\n        {\n            this.DeleteUnit(this.mapBulletUnit[key]);\n        }\n        this.mapBulletUnit = {};\n\n        this.vToDeleteUnit = [];\n    }\n    \n    update(dt){\n        if(!this.bBegin)\n        {\n            return;\n        }\n        for(let nIndex=0; nIndex < this.vToDeleteUnit.length; ++nIndex)\n        {\n            this.DeleteUnit(this.vToDeleteUnit[nIndex]);\n        }\n        this.vToDeleteUnit = [];\n\n        this.playerMe.update(dt);\n        for(let key in this.mapEnemyUnit)\n        {\n            this.mapEnemyUnit[key].update(dt);\n        }\n        for(let key in this.mapBulletUnit)\n        {\n            this.mapBulletUnit[key].update(dt);\n        }\n        this.CheclCollision();\n    }\n\n    CheclCollision()\n    {\n        \n        for(let ke in this.mapEnemyUnit)\n        {\n            let enemy = this.mapEnemyUnit[ke];\n            if(enemy.bDead)\n            {\n                continue;\n            }\n            let eBox = enemy.rootNode.getBoundingBox(); //Rect\n\n            for(let kb in this.mapBulletUnit)\n            {\n                let bullet = this.mapBulletUnit[kb];\n                if(bullet.bDead)\n                {\n                    continue;\n                }\n                let bBox = bullet.rootNode.getBoundingBox(); \n                if(eBox.intersects(bBox))\n                {\n                    bullet.bDead = true;\n                    BWUnitManager.Instance.AddUnitToDelete(bullet);\n                    //BWUnitManager.Instance.AddUnitToDelete(enemy);\n                    enemy.BeAttacked();\n                }\n            }\n\n            let meBox = this.playerMe.rootNode.getBoundingBox(); \n            if(eBox.intersects(meBox))\n            {\n                enemy.Dead();\n                this.playerMe.BeAttacked();\n            }\n\n        }\n        \n    }\n\n\n    AddUnitToDelete(unit: BWUnit)\n    {\n        //unit.bDead = true;\n        this.vToDeleteUnit.push(unit);\n    }\n    DeleteUnit(unit: BWUnit)\n    {\n        let eUnitType = Math.floor(unit.nId/100000);\n        if(eUnitType === EUnitType.ENEMY)\n        {\n            this.mapEnemyUnit[unit.nId].OnDead();\n            delete this.mapEnemyUnit[unit.nId];\n        }\n        else if (eUnitType === EUnitType.BULLET)\n        {\n            this.mapBulletUnit[unit.nId].OnDead();\n            delete this.mapBulletUnit[unit.nId];\n        }\n    }\n\n\n\n    CreatePlayer(): BWUnit\n    {\n        this.playerMe = new BWPlayerUnit();\n        this.playerMe.Init();\n        this.nCreateId++;\n        this.playerMe.nId = EUnitType.ME * 100000 + this.nCreateId;\n        return this.playerMe;\n    }\n\n    CreateEnemy(): BWUnit\n    {\n        let enemy = new BWEnemyUnit();\n        enemy.Init();\n        this.nCreateId++;\n        enemy.nId = EUnitType.ENEMY * 100000 + this.nCreateId;\n        this.mapEnemyUnit[enemy.nId] = enemy;\n        return enemy;\n    }\n\n    CreateBullet(): BWUnit\n    {\n        let bullet = new BWBulletUnit();\n        bullet.Init();\n        this.nCreateId++;\n        bullet.nId = EUnitType.BULLET * 100000 + this.nCreateId;\n        this.mapBulletUnit[bullet.nId] = bullet;\n        return bullet;\n    }\n\n    AddScore()\n    {\n        this.nScore += 1;\n        EventManager.Instance.FireEvent(ECMDID.REFRESHSCORE);\n    }\n    \n\n\n\n    \n}\n"]}