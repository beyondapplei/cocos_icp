{"version":3,"sources":["assets/Script/ui/EditPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIPanel from \"./UIPanel\"\nimport UIManager from \"../UIManager\";\nimport { EUIPanelType, ECMDID } from \"../CommonEnum\";\nimport BWUnitManager from \"../BWUnitManager\";\nimport BWUnit from \"./BWUnit\";\nimport BWPlayerUnit from \"./BWPlayerUnit\";\nimport EventManager from \"../EventManager\";\nimport BWEnemyUnit from \"./BWEnemyUnit\";\n\n\nclass ElementData{\n    ntype: number;\n    x:number;\n    y:number;\n}\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class EditPanel extends UIPanel {\n\n    battleNode: cc.Node;\n    playerMe: BWUnit;\n    battleCamera: cc.Camera;\n    //onload->start->onopen\n    nCreateEnemyCd: number = 0.2;\n    nCreateEnemyCdDt: number = 0;\n\n    vElementData = [];\n    editBox: cc.EditBox;\n    nCurLevel: number = 1;\n\n    vUnit: BWUnit[] = [];\n\n    onLoad(){\n        \n        let btnBeginNode = this.node.getChildByName('btnbegin');\n        btnBeginNode.on(cc.Node.EventType.TOUCH_END, this.clickBegin.bind(this,109825),this);\n\n        let btnBeginNode2 = this.node.getChildByName('btnbegin2');\n        btnBeginNode2.on(cc.Node.EventType.TOUCH_END, this.ClickSave.bind(this,109825),this);\n\n        this.battleNode = this.node.getChildByName('battlenode');\n        //this.battleCamera = this.battleNode.getChildByName(\"battlecamera\").getComponent(cc.Camera);\n\n        this.editBox = this.node.getChildByName('NewEditBox').getComponent(cc.EditBox);\n        this.editBox.string = \"1\";\n        //btnBeginNode2.on(cc.Node.EventType.TOUCH_END, this.ClickSave.bind(this,109825),this);\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove.bind(this),this);\n\n        let btnLoadNode = this.node.getChildByName('NewButton');\n        btnLoadNode.on(cc.Node.EventType.TOUCH_END, this.ClickLoad,this);\n\n\n    }\n    start () {}\n    update(dt)\n    {\n    }\n    lateUpdate()\n    {\n        //this.battleCamera.node.y +=  this.playerMe.nSpeedY;\n    }\n    ClickLoad()\n    {\n        cc.log(this.nCurLevel);\n\n        let strFileName = \"level_\"+this.editBox.string+\".json\";\n\n        //strFileName = strFileName.format();\n        this.ReadLevel(strFileName);\n    }\n    \n\n    EventOpt(bAdd: boolean)\n    {\n        \n    }\n\n    OnOpen( strParam: string )\n    {\n        //this.ReadLevel(\"level_01.json\");\n\n    }\n\n    \n    GetLocalResourcePath(): string\n    {\n        return \"/Users/binwang/Documents/NewProjectHelloTypeScript/assets/resources/\";\n    }\n    ReadLevel(strFileName: string)\n    {\n        //var path = cc.url.raw('xxxx');\n        //if (cc.loader.md5Pipe) {\n        //path = cc.loader.md5Pipe.transformURL(path);\n        //}\n\n        //let strPath = this.GetLocalResourcePath();\n        //strPath += strFileName;\n        let strPath =  cc.url.raw('resources/'+strFileName);\n        cc.log(\"resourcePath=\"+strPath);\n        cc.loader.load(strPath, function(err,res){\n            if (err) {\n                cc.log(err);\n            }else{\n                cc.log(\"loadsuccess=\"+res.json)\n                this.vElementData = res.json;\n                //this.WriteLevel(\"level_01.json\");\n                //cc.log(\"length=\"+this.vElementData.length);\n                this.InitLevel();\n\n            }\n        }.bind(this));\n       \n    }\n    InitLevel()\n    {\n        this.vUnit = [];\n        for(let nIndex=0; nIndex < this.vElementData.length; ++nIndex)\n        {\n            let oneEle = this.vElementData[nIndex];\n            \n            let unit = new BWEnemyUnit();\n            unit.Init();\n            unit.rootNode.position = new cc.Vec3(this.ToCorrectX(oneEle.x), oneEle.y, 0);\n            this.vUnit.push(unit);\n        }\n\n    }\n    \n\n    ToCorrectX(nX: number)\n    {\n        nX = Math.floor(nX/80) * 80 + 80*0.5;\n        return nX;\n\n    }\n\n    WriteLevel(strFileName: string)\n    {\n        cc.log(\"WriteLevel=length=\"+this.vElementData.length);\n\n        //this.vElementData.splice(0, 1);\n\n        if(cc.sys.isNative)\n        {\n            //let strWritePath = jsb.fileUtils.getWritablePath();\n            //strWritePath += strFileName;\n            //cc.log(\"strWritePath=\"+strWritePath);\n\n            let strPath = this.GetLocalResourcePath();\n            strPath += strFileName;\n            let strJsonContent = JSON.stringify(this.vElementData);\n            cc.log(\"strPath=\"+strPath);\n            cc.log(\"strJsonContent=\"+strJsonContent);\n            jsb.fileUtils.writeStringToFile(strJsonContent,strPath);\n        }\n\n          //writeToFile()写入数据到文件，存储格式为xml，不是Json格式\n          if(cc.sys.isNative) {\n            //cc.log(\"Path:\"+jsb.fileUtils.getWritablePath());\n            //cc.log( jsb.fileUtils.writeToFile({\"new\":\"value\"},jsb.fileUtils.getWritablePath()+'data.json'));\n \n            //cc.log(\"fullPathForFilename:\"+jsb.fileUtils.fullPathForFilename(\"resources/data.json\"));\n         }\n\n\n\n        // cc.log(\"writeStringToFile:\"+jsb.fileUtils.writeStringToFile('{\"a\":\"b\",\"c\":\"d\"}', jsb.fileUtils.getWritablePath()+'kk.json'));\n        // cc.log(\"getValueMapFromFile:\"+JSON.stringify(jsb.fileUtils.getValueMapFromFile(jsb.fileUtils.getWritablePath()+\"kk.json\")));\n \n        // var arry=JSON.stringify(jsb.fileUtils.getStringFromFile(jsb.fileUtils.getWritablePath()+\"kk.json\"));\n        // cc.log(\"arry:\"+arry);\n        \n        //    cc.loader.load(jsb.fileUtils.getWritablePath()+\"kk.json\", function(err,res){\n        //     if (err) {\n        //         cc.log(err);\n        //     }else{\n        //         let list=res;\n                \n        //         cc.log(\"list:\"+list.a);\n        //     }\n        // });\n\n\n\n    }\n\n    onClose(){\n        this.EventOpt(false);\n\n    }  \n    //--------\n\n    \n    \n\n    ClickSave()\n    {\n        this.WriteLevel(\"level_01.json\")\n    }\n    touchMove(e)\n    {\n        cc.log( \"cc.Node.EventType.TOUCH_MOVE\" );\n        let move_x = e.touch._point.x - e.touch._prevPoint.x;\n        let move_y = e.touch._point.y - e.touch._prevPoint.y;\n        this.battleNode.x = this.playerMe.rootNode.x + move_x;\n        this.battleNode.y = this.playerMe.rootNode.y + move_y;\n        \n    }\n\n    \n\n    \n\n    \n    \n    clickBegin(nTag){\n        cc.log('clickbegin'+nTag);\n        UIManager.Instance.closePanel(EUIPanelType.GAME);\n    }\n\n    \n}\n"]}