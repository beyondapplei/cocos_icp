{"version":3,"sources":["assets/Script/ui/wallet/ICPWalletPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIPanel from \"../UIPanel\"\nimport UIManager from \"../../UIManager\";\nimport { EUIPanelType } from \"../../CommonEnum\";\nimport {TableView,CellData} from \"../TableView\";\nimport ResManager from \"../../ResManager\";\nimport ICPManager from \"../../mg/ICPManager\";\nimport LoginManager from \"../../mg/LoginManager\";\nimport { LEAGER_ICP_ID_LOCAL } from \"../../mg/DefData\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ICPWalletPanel extends UIPanel {\n\n    tableview: TableView;\n  \n    editBox: cc.EditBox;\n    nIndexReq: number;\n    nOrderState: number;\n\n    labelrec: cc.Label;\n    labelbalance: cc.Label;\n\n    boxtoaddress: cc.EditBox;\n    boxamount: cc.EditBox;\n\n    onLoad(){\n        this.nOrderState = 0;\n       \n        const btnNode =  this.node.getChildByName('btnbegin');\n        btnNode.on(cc.Node.EventType.TOUCH_END, this.clickBegin.bind(this, 109825), this);\n        \n        this.labelrec = this.node.getChildByName('labelrec').getComponent(cc.Label);\n        this.labelbalance = this.node.getChildByName('labelbalance').getComponent(cc.Label);\n    \n        this.boxtoaddress = this.node.getChildByName('boxtoaddress').getComponent(cc.EditBox);\n        this.boxamount = this.node.getChildByName('boxamount').getComponent(cc.EditBox);\n    \n        \n        this.labelrec.string = \"ICP Rec Address:\\n\" + \"abcd-efgh-ijkl-mnop-qrst-uvwx-yz12-3456-7890\";\n        this.labelbalance.string = \"Balance: 123.456 ICP\";\n\n    }\n    start () {\n    }\n    RefreshUI(){\n        \n    }\n\n    RefreshData() {\n\n    }\n    OnOpen( strParam: string)\n    {\n   \n        let principalText = LoginManager.Instance.getPrincipalText();\n           \n        this.labelrec.string =  principalText || \"\";\n\n        this.labelbalance.string = \"Balance: loading...\";\n        let strIcpLeagerCanisterId = LEAGER_ICP_ID_LOCAL;\n        ICPManager.Instance.GetBalance(principalText, strIcpLeagerCanisterId)\n            .then((balanceText) => {\n                this.labelbalance.string = balanceText;\n            })\n            .catch((e) => {\n                cc.error('ICPWalletPanel: GetBalance failed:', e);\n                this.labelbalance.string = 'Balance: error';\n            });\n      \n\n    }\n\n    \n\n    OnClose()\n    {\n        \n    }\n \n\n    clickBegin(nTag){\n        cc.log('clickbegin'+nTag);\n        //UIManager.Instance.OpenPanel(EUIPanelType.HOME);\n\n        //发送icp\n\n        let toText = (this.boxtoaddress && this.boxtoaddress.string) ? this.boxtoaddress.string.trim() : '';\n        let amountText = (this.boxamount && this.boxamount.string) ? this.boxamount.string.trim() : '';\n        if (!toText || !amountText) {\n            UIManager.ShowTip('请输入收款地址和金额');\n            return;\n        }\n\n        //此处用于测试 硬编码测试 bwtest\n        toText = \"vo6oa-rnbla-yuwhp-omwcn-ujfnh-pqlhz-ukcbb-xyr75-zqvlm-hxzd6-jqe\"\n        amountText = \"1\"\n\n        \n        const strIcpLeagerCanisterId = LEAGER_ICP_ID_LOCAL;\n        UIManager.ShowTip('Sending ICP...');\n        ICPManager.Instance.SendICP(toText, amountText, strIcpLeagerCanisterId)\n            .then((msg) => {\n                UIManager.ShowTip(msg);\n                const principalText = LoginManager.Instance.getPrincipalText();\n                return ICPManager.Instance.GetBalance(principalText, strIcpLeagerCanisterId);\n            })\n            .then((balanceText) => {\n                this.labelbalance.string = balanceText;\n            })\n            .catch((e) => {\n                cc.error('ICPWalletPanel: SendICP failed:', e);\n                UIManager.ShowTip('发送失败: ' + (e && e.message ? e.message : e));\n            });\n\n    }\n\n    clickOrder(nTag){\n       \n            \n    \n\n\n    }\n\n    \n}\n"]}