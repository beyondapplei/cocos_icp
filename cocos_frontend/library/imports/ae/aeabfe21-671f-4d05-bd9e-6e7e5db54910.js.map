{"version":3,"sources":["assets/Script/ui/HomePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport UIPanel from \"./UIPanel\"\nimport UIManager from \"../UIManager\";\nimport BackManager from \"../mg/BackManager\";\nimport LoginManager from \"../mg/LoginManager\";\nimport {ECMDID, ESceneType, EUIPanelType, EUnitType} from \"../CommonEnum\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class HomePanel extends UIPanel{\n    \n    // 业务逻辑全部交给 BackManager；此类仅负责 UI\n\n    @property(cc.Label)\n    labelpid: cc.Label;\n\n    @property(cc.Sprite)\n    sprole: cc.Sprite\n    \n    onLoad(){\n        \n         function onLoadTexturebEnd(err, spriteFrame)\n        {\n            \n        }\n      \n       \n       cc.loader.loadRes( \"texture/imagebg11\", cc.SpriteFrame, onLoadTexturebEnd.bind(this));\n       //在scene中预加载资源 后能显示\n       //cc.loader.loadRes( \"texture/bullet\", cc.SpriteFrame);\n\n        \n        const btnBeginNode = this.node.getChildByName('btnbegin');\n        btnBeginNode.on(cc.Node.EventType.TOUCH_END, this.clickLogin.bind(this,109825),this);\n\n        //此界面用的是homepanel.prefab\n        const labelpidNode = this.node.getChildByName('labelpid');\n        this.labelpid = labelpidNode.getComponent(cc.Label);\n \n        const sproleNode = this.node.getChildByName('sprole');\n        this.sprole = sproleNode.getComponent(cc.Sprite);\n        \n\n    }\n    start () {\n       \n    }\n    //在它被加入场景树并激活后，会先 onLoad()，等到下一轮/下一帧开始更新时再 start()\n    OnOpen( strParam: string)\n    {\n         // Web Build 下提前初始化，保证点击时仍处于用户手势上下文（避免弹窗被浏览器拦截）\n    \n        UIManager.ShowTip(\"HomePanel start\");\n        this.uiend();\n\n    }\n\n    OnClose()\n    {\n        \n    }\n\n    uiend() {\n        this.showinfo(\"HomePanel uiend\");\n\n        LoginManager.Instance.ensureAuthClient()\n            .then(() => LoginManager.Instance.isAuthenticated())\n            .then((authed) => {\n                if (authed) {\n                    this.showinfo(\"HomePanel: Already authenticated\");\n                    this.handleLoginSuccess();\n                } else {\n                    this.showinfo(\"HomePanel: Not authenticated\");\n                }\n            })\n            .catch((e) => {\n                cc.error(\"HomePanel: BackManager init error:\", e);\n                this.showinfo(\"Init Error: \" + e);\n            });\n    }\n\n    \n    showinfo( strMsg: string){\n        cc.log(\"HomePanel: showinfo \" + strMsg);\n        UIManager.ShowTip( strMsg);\n    }\n\n   //login\n    login() {\n        LoginManager.Instance.login(\n            () => this.handleLoginSuccess(),\n            (e) => this.showinfo(\"Login Error: \" + (e.message || e))\n        );\n    }\n    \n    clickLogin(nTag){\n        this.showinfo(\"HomePanel clickLogin\");\n        cc.log(\"clickbegin\"+nTag);\n        //UIManager.Instance.OpenPanel(EUIPanelType.LOGIN);\n\n        this.login();\n    }\n\n    async handleLoginSuccess() {\n        const principal = LoginManager.Instance.getPrincipalText();\n        if (principal) {\n            this.showinfo(\"Login Success! Principal: \" + principal);\n            this.labelpid.string = principal;\n        } else {\n            this.showinfo(\"Login Success!\");\n        }\n\n        UIManager.OpenPanel(EUIPanelType.HOMELIST); //tables 列表\n    }\n\n    async onGetAddressClick() {\n        const principal = LoginManager.Instance.getPrincipalText();\n       try {\n            const address = await BackManager.Instance.getEthAddress();\n            this.showinfo('ETH Address: ' + address);\n            if (this.labelpid) {\n                this.labelpid.string = (principal || this.labelpid.string || '') + \"\\n\" + address;\n            }\n        } catch (e) {\n            cc.error('HomePanel: getEthAddress failed:', e);\n            this.showinfo('Fetch address failed: ' + e);\n        }\n    }\n\n    \n}\n"]}